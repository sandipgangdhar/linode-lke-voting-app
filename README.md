# ğŸ—³ï¸ Linode LKE Voting App Demo

A complete Terraform-based demo showcasing a scalable Kubernetes Voting App deployed on **Linode Kubernetes Engine (LKE)** with:

- ğŸ”„ Horizontal Pod Autoscaling (HPA)
- ğŸ§  Metrics Server Patch
- ğŸ—³ï¸ Voting app (Redis, Flask, Worker, PostgreSQL)
- â˜ï¸ Linode Managed PostgreSQL
- ğŸ“¦ Kubernetes-native init job for DB setup

---

## ğŸš€ Features

| Feature                        | Description                                                  |
|-------------------------------|--------------------------------------------------------------|
| ğŸŒ LKE Cluster                 | Linode Kubernetes Engine with 3 worker nodes                |
| ğŸ—³ï¸ Voting App                 | Classic Flask-based voting app with Redis + PostgreSQL      |
| âš™ï¸ Terraform Automation       | Full Infra & App lifecycle via Terraform                    |
| ğŸ“ˆ HPA Enabled                 | CPU-based autoscaling of `vote`, `result`, `worker` pods    |
| ğŸ“Š Metrics Server Patch       | Secure port (4443), liveness/readiness fix for HPA          |
| ğŸ” Secret Management           | PostgreSQL credentials injected as Kubernetes Secret        |
| ğŸ§© DB Init Job                | K8s Job creates DB & tables during deployment               |

---

## ğŸ“ Project Structure

```
linode-lke-voting-app/
â”œâ”€â”€ terraform/
â”‚   â””â”€â”€ voting-app/
â”‚       â”œâ”€â”€ vote-deployment.yaml
â”‚       â”œâ”€â”€ result-deployment.yaml
â”‚       â”œâ”€â”€ worker-deployment.yaml
â”‚       â”œâ”€â”€ redis-deployment.yaml
â”‚       â”œâ”€â”€ db-init-job.yaml         # ğŸ” Creates DB + table
â”‚       â”œâ”€â”€ hpa.yaml
â”‚       â”œâ”€â”€ services.yaml
â”‚       â”œâ”€â”€ vote-service.yaml
â”‚       â””â”€â”€ result-service.yaml
â”œâ”€â”€ main.tf                         # ğŸ§  Terraform logic
â”œâ”€â”€ variables.tf                    # ğŸ“¥ Input variables
â”œâ”€â”€ outputs.tf                      # ğŸ“¤ Useful outputs
â””â”€â”€ kubeconfig                      # ğŸ”‘ Auto-generated by Terraform
```

---

## ğŸ§° Prerequisites

- âœ… [Terraform](https://www.terraform.io/downloads.html) v1.3+
- âœ… [kubectl](https://kubernetes.io/docs/tasks/tools/) installed & in `$PATH`
- âœ… `linode-cli` configured with your access token
- âœ… Terraform Cloud or local `TF_VAR_linode_token` set

---

## ğŸš€ How to Deploy

### 1. Clone the Repo

```bash
git clone https://github.com/YOUR-USERNAME/linode-lke-voting-app.git
cd linode-lke-voting-app
```

### 2. Set your variables

Update the `terraform.tfvars` file or pass as `-var` flags:

```hcl
linode_token = "your-linode-token"
region       = "your-region"         # e.g. "ap-south"
cluster_label = "voting-cluster"
pg_database   = "voting"
```

### 3. Initialize and Apply

```bash
terraform init
terraform apply -auto-approve
```

---

## ğŸŒ Access the App

Get the external IP of the vote service:

```bash
kubectl get svc vote -o wide
```

Visit `http://<EXTERNAL-IP>` in your browser to cast votes.

---

## ğŸ”¬ Testing HPA

### Simulate Load:

```bash
seq 1 20 | xargs -n1 -P20 -I{} bash -c 'while true; do curl -s http://<EXTERNAL-IP> -d "vote=a" > /dev/null; done'
```

### Watch Auto-scaling:

```bash
kubectl get hpa -w
```

---

## ğŸ§¹ Cleanup

```bash
terraform destroy -auto-approve
```

---

## ğŸ“ License

This project is open-source and available under the [MIT License](LICENSE).

---

## ğŸ™Œ Acknowledgements

Built using:
- [Terraform](https://terraform.io)
- [Kubernetes](https://kubernetes.io)
- [Linode LKE](https://www.linode.com/products/kubernetes/)
- [Docker Voting App](https://github.com/dockersamples/example-voting-app)

---

> ğŸ’¡ Maintained by [@sandipgangdhar](https://github.com/sandipgangdhar)
